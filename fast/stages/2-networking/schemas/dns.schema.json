{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DNS Zone configuration",
  "description": "Schema for DNS zone YAML configuration files.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "project_id": {
      "type": "string",
      "description": "Project ID for the DNS zone."
    },
    "description": {
      "type": "string",
      "description": "Optional description for the DNS zone."
    },
    "force_destroy": {
      "type": "boolean",
      "description": "Whether to force deletion of the zone."
    },
    "domain": {
      "type": "string",
      "description": "Domain name for the zone (e.g. 'example.com.')."
    },
    "iam": {
      "$ref": "#/$defs/iam"
    },
    "recordsets": {
      "$ref": "#/$defs/recordsets"
    },
    "private": {
      "$ref": "#/$defs/private_zone"
    },
    "peering": {
      "$ref": "#/$defs/peering_zone"
    },
    "forwarding": {
      "$ref": "#/$defs/forwarding_zone"
    }
  },
  "required": [
    "project_id"
  ],
  "oneOf": [
    {
      "title": "Private Zone",
      "required": [
        "private"
      ],
      "properties": {
        "peering": {
          "not": {}
        },
        "forwarding": {
          "not": {}
        }
      }
    },
    {
      "title": "Peering Zone",
      "required": [
        "peering"
      ],
      "properties": {
        "private": {
          "not": {}
        },
        "forwarding": {
          "not": {}
        }
      }
    },
    {
      "title": "Forwarding Zone",
      "required": [
        "forwarding"
      ],
      "properties": {
        "private": {
          "not": {}
        },
        "peering": {
          "not": {}
        }
      }
    }
  ],
  "$defs": {
    "iam": {
      "type": "object",
      "additionalProperties": false,
      "patternProperties": {
        "^(?:roles/|\\$custom_roles:)": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^(?:domain:|group:|serviceAccount:|user:|principal:|principalSet:||\\$iam_principals:[a-z0-9_-]+)"
          }
        }
      }
    },
    "recordsets": {
      "type": "object",
      "description": "Map of DNS recordsets.",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "records": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "records"
        ]
      }
    },
    "private_zone": {
      "description": "Private zone specific configuration.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "service_directory_namespace": {
          "type": "string"
        },
        "client_networks": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "client_networks"
      ]
    },
    "peering_zone": {
      "description": "Peering zone specific configuration.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "peer_network": {
          "type": "string"
        },
        "client_networks": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "peer_network",
        "client_networks"
      ]
    },
    "forwarding_zone": {
      "description": "Forwarding zone specific configuration.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "forwarders": {
          "type": "object",
          "patternProperties": {
            "^.*$": {
              "type": "string"
            }
          }
        },
        "client_networks": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "client_networks"
      ]
    }
  }
}